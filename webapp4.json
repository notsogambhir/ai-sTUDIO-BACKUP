{
  "pages/StudentCOAttainmentReport.tsx": "/**\n * @file StudentCOAttainmentReport.tsx\n * @description\n * This component calculates and displays a detailed report of each student's attainment\n * for every Course Outcome (CO) in a specific course.\n *\n * It has two modes:\n * 1.  **Standalone Page**: When navigated to directly (e.g., from `CourseDetail`), it acts\n *     as a full page with a header, filters, and a print button.\n * 2.  **Embedded Report**: When used inside the `PrintableReport` component (from the main\n *     `AttainmentReports` dashboard), it accepts an `isPrintable` prop and renders a simplified,\n *     print-optimized table without any extra UI.\n */\n\nimport React, { useMemo, useState } from 'react';\nimport { useParams } from 'react-router-dom';\nimport { useAppContext } from '../hooks/useAppContext';\nimport PrintableReport from '../components/PrintableReport';\n\n// This defines the \"props\" or properties that this component accepts.\n// They are optional to allow the component to work in both standalone and embedded modes.\ninterface StudentCOAttainmentReportProps {\n    courseId?: string;\n    isPrintable?: boolean;\n}\n\nconst StudentCOAttainmentReport: React.FC<StudentCOAttainmentReportProps> = ({ courseId: propCourseId, isPrintable = false }) => {\n    // Get the courseId from the URL if it's not passed as a prop.\n    const { courseId: paramCourseId } = useParams<{ courseId: string }>();\n    const courseId = propCourseId || paramCourseId;\n\n    // Get data and user info from the \"magic backpack\".\n    const { data, selectedBatch, currentUser } = useAppContext();\n    const [isPrintModalOpen, setPrintModalOpen] = useState(false);\n\n    const isPCorAdmin = currentUser?.role === 'Program Co-ordinator' || currentUser?.role === 'Admin';\n    const [selectedScope, setSelectedScope] = useState<'overall' | string>('overall');\n\n    // `useMemo` is a smart calculator that finds the course and its sections.\n    const course = useMemo(() => data.courses.find(c => c.id === courseId), [data.courses, courseId]);\n    const courseSections = useMemo(() => {\n        if (!course) return [];\n        const enrolledSectionIds = new Set(data.enrollments.filter(e => e.courseId === course.id && e.sectionId).map(e => e.sectionId!));\n        return data.sections.filter(s => enrolledSectionIds.has(s.id)).sort((a,b) => a.name.localeCompare(b.name));\n    }, [data.enrollments, data.sections, course]);\n\n    /**\n     * This is the main calculation logic for the report, wrapped in `useMemo` for performance.\n     */\n    const attainmentData = useMemo(() => {\n        if (!course || !selectedBatch) return { students: [], courseOutcomes: [], reportData: new Map() };\n\n        // --- Step 1: Filter students based on the user's role and selected scope. ---\n        const courseOutcomes = data.courseOutcomes.filter(co => co.courseId === course.id).sort((a,b) => a.number.localeCompare(b.number));\n        let studentsInScope;\n        // Logic for PC/Admin with scope dropdown\n        if (isPCorAdmin) {\n            if (selectedScope === 'overall') {\n                const batch = data.batches.find(b => b.programId === course.programId && b.name === selectedBatch);\n                if (!batch) return { students: [], courseOutcomes: [], reportData: new Map() };\n                const sectionIdsForBatch = new Set(data.sections.filter(s => s.batchId === batch.id).map(s => s.id));\n                const studentIdsInBatch = new Set(data.students.filter(s => s.sectionId && sectionIdsForBatch.has(s.sectionId)).map(s => s.id));\n                studentsInScope = data.students.filter(s => studentIdsInBatch.has(s.id) && data.enrollments.some(e => e.studentId === s.id && e.courseId === course.id));\n            } else { // A specific section is selected\n                 studentsInScope = data.students.filter(s => s.sectionId === selectedScope && data.enrollments.some(e => e.studentId === s.id && e.courseId === course.id));\n            }\n        } else { // Logic for a Teacher (auto-scoped)\n            const teacherId = currentUser!.id;\n            const teacherSectionIds = new Set<string>();\n            courseSections.forEach(section => {\n                const sectionTeacher = course.sectionTeacherIds?.[section.id];\n                if ((sectionTeacher && sectionTeacher === teacherId) || (!sectionTeacher && course.teacherId === teacherId)) {\n                    teacherSectionIds.add(section.id);\n                }\n            });\n            studentsInScope = data.students.filter(s => s.sectionId && teacherSectionIds.has(s.sectionId) && data.enrollments.some(e => e.studentId === s.id && e.courseId === course.id));\n        }\n\n        const activeStudents = studentsInScope.filter(s => s.status === 'Active').sort((a, b) => a.id.localeCompare(b.id));\n\n        // --- Step 2: Pre-calculate helper maps for performance. ---\n        const sectionIdsForCourse = new Set(data.enrollments.filter(e => e.courseId === course.id && e.sectionId).map(e => e.sectionId!));\n        const assessmentsForCourse = data.assessments.filter(a => sectionIdsForCourse.has(a.sectionId));\n        const coQuestionMap = new Map<string, { q: string; maxMarks: number; assessmentId: string }[]>();\n        courseOutcomes.forEach(co => coQuestionMap.set(co.id, []));\n        assessmentsForCourse.forEach(assessment => {\n            assessment.questions.forEach(q => q.coIds.forEach(coId => coQuestionMap.get(coId)?.push({ ...q, assessmentId: assessment.id })));\n        });\n\n        // --- Step 3: Loop through each student and calculate their attainment for each CO. ---\n        const reportData = new Map<string, { [coId: string]: number }>();\n        activeStudents.forEach(student => {\n            const studentAttainment: { [coId: string]: number } = {};\n            courseOutcomes.forEach(co => {\n                const questionsForCo = coQuestionMap.get(co.id) || [];\n                const totalMaxCoMarks = questionsForCo.reduce((sum, q) => sum + q.maxMarks, 0);\n                let totalObtainedCoMarks = 0;\n                const studentMarks = data.marks.filter(m => m.studentId === student.id);\n                questionsForCo.forEach(q => {\n                    const mark = studentMarks.find(m => m.assessmentId === q.assessmentId);\n                    const score = mark?.scores.find(s => s.q === q.q);\n                    if (score) { totalObtainedCoMarks += score.marks; }\n                });\n                studentAttainment[co.id] = totalMaxCoMarks > 0 ? (totalObtainedCoMarks / totalMaxCoMarks) * 100 : 0;\n            });\n            reportData.set(student.id, studentAttainment);\n        });\n        return { students: activeStudents, courseOutcomes, reportData };\n    }, [course, selectedBatch, data, selectedScope, isPCorAdmin, currentUser, courseSections]);\n\n    if (!course) return <div>Course not found.</div>;\n    const { students, courseOutcomes, reportData } = attainmentData;\n\n    /**\n     * A reusable function to render the main data table. It can render a full version for the\n     * screen or a simplified, denser version for printing.\n     */\n    const renderTable = (printable: boolean) => (\n        <table className={`min-w-full border-collapse ${printable ? 'text-xs border border-gray-400' : 'divide-y divide-gray-200'}`}>\n            <thead className={`${printable ? 'bg-gray-200' : 'bg-gray-50'}`}>\n                <tr>\n                    <th className={`p-2 text-left font-medium ${printable ? 'border border-gray-400' : 'px-6 py-3 text-gray-500 uppercase tracking-wider'}`}>Student ID</th>\n                    <th className={`p-2 text-left font-medium ${printable ? 'border border-gray-400' : 'px-6 py-3 text-gray-500 uppercase tracking-wider'}`}>Student Name</th>\n                    {courseOutcomes.map(co => (\n                        <th key={co.id} className={`p-2 text-center font-medium ${printable ? 'border border-gray-400' : 'px-4 py-3 text-gray-500 uppercase tracking-wider'}`}>{co.number}</th>\n                    ))}\n                </tr>\n            </thead>\n            <tbody className={`${printable ? '' : 'bg-white divide-y divide-gray-200'}`}>\n                {students.map(student => (\n                    <tr key={student.id}>\n                        <td className={`p-2 font-medium ${printable ? 'border border-gray-400' : 'px-6 py-4 whitespace-nowrap text-gray-900'}`}>{student.id}</td>\n                        <td className={`p-2 ${printable ? 'border border-gray-400' : 'px-6 py-4 whitespace-nowrap text-gray-600'}`}>{student.name}</td>\n                        {courseOutcomes.map(co => {\n                            const attainment = reportData.get(student.id)?.[co.id] ?? 0;\n                            const achievedTarget = attainment >= course.target;\n                            return (\n                                <td key={co.id} className={`p-2 text-center font-semibold ${printable ? 'border border-gray-400' : ''} ${achievedTarget ? 'text-green-600' : 'text-red-600'}`}>\n                                    {attainment.toFixed(1)}%\n                                </td>\n                            );\n                        })}\n                    </tr>\n                ))}\n            </tbody>\n        </table>\n    );\n\n    // If the component is in \"printable\" mode, it just renders the table.\n    if (isPrintable) {\n        return (\n            <div className=\"space-y-4\">\n                <h2 className=\"text-xl font-bold text-gray-700 mb-4\">Student-wise Attainment Details</h2>\n                {students.length > 0 ? renderTable(true) : <p className=\"text-center py-8 text-gray-500\">No student data available for this report.</p>}\n            </div>\n        );\n    }\n    \n    // Otherwise, it renders the full standalone page.\n    return (\n        <div className=\"space-y-6\">\n            <div className=\"flex justify-between items-center\">\n                <div>\n                    <h2 className=\"text-2xl font-bold text-gray-800\">Student-wise CO Attainment Report</h2>\n                    <p className=\"text-gray-500\">Course: {course.name} ({course.code}) | Target: {course.target}%</p>\n                </div>\n                <button onClick={() => setPrintModalOpen(true)} className=\"bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg\">\n                    Print Report\n                </button>\n            </div>\n            {isPCorAdmin && courseSections.length > 0 && (\n                 <div>\n                    <label htmlFor=\"section-scope-select\" className=\"block text-sm font-medium text-gray-700\">Filter by Section:</label>\n                    <select id=\"section-scope-select\" value={selectedScope} onChange={e => setSelectedScope(e.target.value)} className=\"mt-1 block w-full max-w-xs pl-3 pr-10 py-2 text-base bg-white text-gray-900 border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md\">\n                        <option value=\"overall\">Overall Batch</option>\n                        {courseSections.map(section => ( <option key={section.id} value={section.id}>Section {section.name}</option> ))}\n                    </select>\n                </div>\n            )}\n            <div className=\"overflow-x-auto bg-white rounded-lg shadow-md\">\n                {students.length > 0 ? renderTable(false) : <p className=\"text-center py-8 text-gray-500\">No student data available for the selected scope.</p>}\n            </div>\n            {isPrintModalOpen && (\n                <PrintableReport title={`Student CO Attainment - ${course.name}`} onClose={() => setPrintModalOpen(false)}>\n                    {renderTable(true)}\n                </PrintableReport>\n            )}\n        </div>\n    );\n};\n\nexport default StudentCOAttainmentReport;",
  "components/Icons.tsx": "/**\n * @file Icons.tsx\n * @description\n * This file is a simple library of all the small icon images used throughout the application.\n *\n * Instead of embedding the complex SVG code for an icon directly into every button or\n * menu item that uses it, we define each icon here as a reusable React component.\n *\n * This approach has several benefits:\n * 1.  **Organization**: All icons are in one place, making them easy to find and manage.\n * 2.  **Reusability**: We can use the same icon component (e.g., `<Trash2 />`) in many\n *     different places without duplicating code.\n * 3.  **Consistency**: Ensures that all icons have a consistent style and set of properties.\n * 4.  **Readability**: Makes the code in other components cleaner, as `<Users />` is much\n *     easier to read than a 20-line block of SVG code.\n *\n * Each function in this file returns a piece of SVG markup, which is how vector graphics\n * are drawn on the web.\n */\n\nimport React from 'react';\n\n// This defines a generic type for the props that our icon components can accept.\n// It allows us to pass standard SVG attributes like `className`, `width`, `height`, etc.\ntype IconProps = React.SVGProps<SVGSVGElement>;\n\n// Each of the following lines exports a single icon component.\nexport const GraduationCap = (props: IconProps) => <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}><path d=\"M22 10v6M2 10l10-5 10 5-10 5z\"/><path d=\"M6 12v5c3 3 12 3 15 0v-5\"/></svg>;\nexport const BookOpen = (props: IconProps) => <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}><path d=\"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z\"/><path d=\"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z\"/></svg>;\nexport const Target = (props: IconProps) => <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}><circle cx=\"12\" cy=\"12\" r=\"10\"/><circle cx=\"12\" cy=\"12\" r=\"6\"/><circle cx=\"12\" cy=\"12\" r=\"2\"/></svg>;\nexport const Users = (props: IconProps) => <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}><path d=\"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2\"/><circle cx=\"9\" cy=\"7\" r=\"4\"/><path d=\"M22 21v-2a4 4 0 0 0-3-3.87\"/><path d=\"M16 3.13a4 4 0 0 1 0 7.75\"/></svg>;\nexport const PieChart = (props: IconProps) => <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}><path d=\"M21.21 15.89A10 10 0 1 1 8 2.83\"/><path d=\"M22 12A10 10 0 0 0 12 2v10z\"/></svg>;\nexport const Settings = (props: IconProps) => <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}><path d=\"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 0 2l-.15.08a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l-.22-.38a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1 0-2l.15-.08a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z\"/><circle cx=\"12\" cy=\"12\" r=\"3\"/></svg>;\nexport const LogOut = (props: IconProps) => <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}><path d=\"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4\"/><polyline points=\"16 17 21 12 16 7\"/><line x1=\"21\" y1=\"12\" x2=\"9\" y2=\"12\"/></svg>;\nexport const PlusCircle = (props: IconProps) => <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}><circle cx=\"12\" cy=\"12\" r=\"10\"></circle><line x1=\"12\" y1=\"8\" x2=\"12\" y2=\"16\"></line><line x1=\"8\" y1=\"12\" x2=\"16\" y2=\"12\"></line></svg>;\nexport const Trash2 = (props: IconProps) => <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}><polyline points=\"3 6 5 6 21 6\"></polyline><path d=\"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2\"></path><line x1=\"10\" y1=\"11\" x2=\"10\" y2=\"17\"></line><line x1=\"14\" y1=\"11\" x2=\"14\" y2=\"17\"></line></svg>;\nexport const ArrowLeft = (props: IconProps) => <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}><line x1=\"19\" y1=\"12\" x2=\"5\" y2=\"12\"></line><polyline points=\"12 19 5 12 12 5\"></polyline></svg>;\nexport const Edit = (props: IconProps) => <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}><path d=\"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7\"></path><path d=\"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z\"></path></svg>;\nexport const Upload = (props: IconProps) => <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}><path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"></path><polyline points=\"17 8 12 3 7 8\"></polyline><line x1=\"12\" y1=\"3\" x2=\"12\" y2=\"15\"></line></svg>;\nexport const Download = (props: IconProps) => <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}><path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"></path><polyline points=\"7 10 12 15 17 10\"></polyline><line x1=\"12\" y1=\"15\" x2=\"12\" y2=\"3\"></line></svg>;\nexport const ChevronDown = (props: IconProps) => <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}><polyline points=\"6 9 12 15 18 9\"></polyline></svg>;\nexport const ChevronUp = (props: IconProps) => <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}><polyline points=\"18 15 12 9 6 15\"></polyline></svg>;\nexport const Grid = (props: IconProps) => <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}><rect x=\"3\" y=\"3\" width=\"7\" height=\"7\"></rect><rect x=\"14\" y=\"3\" width=\"7\" height=\"7\"></rect><rect x=\"14\" y=\"14\" width=\"7\" height=\"7\"></rect><rect x=\"3\" y=\"14\" width=\"7\" height=\"7\"></rect></svg>;",
  "pages/AttainmentReports.tsx": "/**\n * @file AttainmentReports.tsx\n * @description\n * This component serves as the central hub for generating all major reports in the application.\n * It features an interactive dashboard with tiles for selecting the report type, contextual\n * dropdowns for filtering, and a preview modal for generating and downloading reports.\n */\n\nimport React, { useState, useMemo } from 'react';\nimport { useAppContext } from '../hooks/useAppContext';\nimport PrintableReport from '../components/PrintableReport';\nimport CourseAttainmentSummaryReport from '../components/reports/CourseAttainmentSummaryReport';\nimport AssessmentComparisonReport from '../components/reports/AssessmentComparisonReport';\nimport { PieChart, BookOpen } from '../components/Icons'; // Import icons for the tiles.\n\n// Defines the types of reports the user can generate, along with their properties.\nconst reportTypes = [\n    {\n        id: 'course-attainment-summary',\n        title: 'Course Attainment Summary',\n        description: 'Overall CO attainment and a student-wise breakdown for a course or section.',\n        icon: <PieChart />,\n        requiresCourse: true,\n        requiresScope: true,\n    },\n    {\n        id: 'assessment-comparison',\n        title: 'Assessment Comparison Report',\n        description: 'Compare student performance side-by-side across all assessments in a course.',\n        icon: <BookOpen />,\n        requiresCourse: true,\n        requiresScope: false,\n    },\n];\n\ntype ReportType = typeof reportTypes[number]['id'];\n\nconst AttainmentReports: React.FC = () => {\n    // Get all data and user info from the \"magic backpack\".\n    const { data, selectedProgram, currentUser } = useAppContext();\n\n    // --- State Management for the Report Generation Form ---\n    const [selectedReportId, setSelectedReportId] = useState<ReportType>(reportTypes[0].id);\n    const [selectedCourseId, setSelectedCourseId] = useState<string>('');\n    const [selectedScopeId, setSelectedScopeId] = useState<string>('overall');\n    \n    // `reportData` remembers the parameters for the report to be generated.\n    // When this is not null, the `PrintableReport` modal is shown.\n    const [reportData, setReportData] = useState<{ type: ReportType, courseId: string, scopeId: string } | null>(null);\n\n    // `useMemo` is a smart calculator that gets the currently selected report's configuration.\n    const selectedReportInfo = useMemo(() => reportTypes.find(r => r.id === selectedReportId)!, [selectedReportId]);\n\n    // --- Data Filtering for Dropdowns ---\n    const availableCourses = useMemo(() => {\n        if (!selectedProgram) return [];\n        if (currentUser?.role === 'Teacher') {\n            return data.courses.filter(c =>\n                c.programId === selectedProgram.id &&\n                (c.teacherId === currentUser.id ||\n                (c.sectionTeacherIds && Object.values(c.sectionTeacherIds).includes(currentUser.id)))\n            );\n        }\n        return data.courses.filter(c => c.programId === selectedProgram.id);\n    }, [data.courses, selectedProgram, currentUser]);\n\n    const availableSections = useMemo(() => {\n        if (!selectedCourseId) return [];\n        const course = data.courses.find(c => c.id === selectedCourseId);\n        if (!course) return [];\n\n        const enrolledSectionIds = new Set(data.enrollments.filter(e => e.courseId === course.id && e.sectionId).map(e => e.sectionId!));\n        const allCourseSections = data.sections.filter(s => enrolledSectionIds.has(s.id));\n\n        if (currentUser?.role === 'Teacher') {\n            const teacherId = currentUser.id;\n            return allCourseSections.filter(section => {\n                const sectionTeacher = course.sectionTeacherIds?.[section.id];\n                return (sectionTeacher && sectionTeacher === teacherId) || (!sectionTeacher && course.teacherId === teacherId);\n            });\n        }\n        \n        return allCourseSections;\n    }, [data.enrollments, data.sections, data.courses, selectedCourseId, currentUser]);\n\n\n    // This runs when the \"Generate Report\" button is clicked.\n    const handleGenerateReport = () => {\n        if (selectedReportInfo.requiresCourse && !selectedCourseId) {\n            alert('Please select a course for this report.');\n            return;\n        }\n        // Set the report data, which will trigger the modal to open.\n        setReportData({ type: selectedReportId, courseId: selectedCourseId, scopeId: selectedScopeId });\n    };\n\n    /**\n     * This helper function renders the correct report component inside the modal.\n     */\n    const renderReportContent = () => {\n        if (!reportData) return null;\n\n        switch (reportData.type) {\n            case 'course-attainment-summary':\n                return <CourseAttainmentSummaryReport courseId={reportData.courseId} scopeId={reportData.scopeId} />;\n            case 'assessment-comparison':\n                return <AssessmentComparisonReport courseId={reportData.courseId} scopeId={reportData.scopeId} />;\n            default:\n                return <p>Invalid report type selected.</p>;\n        }\n    };\n    \n    const selectedCourseName = data.courses.find(c => c.id === reportData?.courseId)?.name || '';\n\n    return (\n        <div className=\"space-y-6\">\n            <h1 className=\"text-3xl font-bold text-gray-800\">Attainment Reports</h1>\n            \n            {/* Step 1: Report Type Selection Tiles */}\n            <div className=\"bg-white p-6 rounded-lg shadow-md\">\n                <h2 className=\"text-xl font-semibold text-gray-700 mb-4\">1. Select a Report Type</h2>\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                    {reportTypes.map(report => (\n                        <button\n                            key={report.id}\n                            onClick={() => setSelectedReportId(report.id)}\n                            className={`p-4 border rounded-lg text-left transition-all duration-200 ${selectedReportId === report.id ? 'bg-indigo-50 border-indigo-500 ring-2 ring-indigo-500' : 'bg-white hover:bg-gray-50'}`}\n                        >\n                            <div className=\"flex items-center\">\n                                <div className={`p-2 rounded-lg ${selectedReportId === report.id ? 'bg-indigo-100 text-indigo-600' : 'bg-gray-100 text-gray-600'}`}>\n                                    {React.cloneElement(report.icon, { className: \"w-6 h-6\" })}\n                                </div>\n                                <h3 className=\"ml-4 text-lg font-bold text-gray-800\">{report.title}</h3>\n                            </div>\n                            <p className=\"mt-2 text-sm text-gray-600\">{report.description}</p>\n                        </button>\n                    ))}\n                </div>\n            </div>\n\n            {/* Step 2: Select Filters & Generate */}\n            <div className=\"bg-white p-6 rounded-lg shadow-md\">\n                 <h2 className=\"text-xl font-semibold text-gray-700 mb-4\">2. Set Filters and Generate</h2>\n                 <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                    {/* Course Selection Dropdown */}\n                    <div>\n                        <label htmlFor=\"course-select\" className=\"block text-sm font-medium text-gray-700\">Course</label>\n                        <select \n                            id=\"course-select\" \n                            value={selectedCourseId} \n                            onChange={e => { setSelectedCourseId(e.target.value); setSelectedScopeId('overall'); }} \n                            className=\"mt-1 block w-full pl-3 pr-10 py-2 text-base bg-white text-gray-900 border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md disabled:bg-gray-100 disabled:cursor-not-allowed\"\n                            disabled={!selectedReportInfo.requiresCourse}\n                        >\n                            <option value=\"\">-- Select a Course --</option>\n                            {availableCourses.map(course => (\n                                <option key={course.id} value={course.id}>{course.code} - {course.name}</option>\n                            ))}\n                        </select>\n                    </div>\n\n                    {/* Scope (Section) Selection Dropdown */}\n                    <div>\n                        <label htmlFor=\"scope-select\" className=\"block text-sm font-medium text-gray-700\">Scope</label>\n                        <select \n                            id=\"scope-select\" \n                            value={selectedScopeId} \n                            onChange={e => setSelectedScopeId(e.target.value)} \n                            className=\"mt-1 block w-full pl-3 pr-10 py-2 text-base bg-white text-gray-900 border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md disabled:bg-gray-100 disabled:cursor-not-allowed\"\n                            disabled={!selectedReportInfo.requiresScope || !selectedCourseId}\n                        >\n                            <option value=\"overall\">Overall Course</option>\n                            {availableSections.map(section => (\n                                <option key={section.id} value={section.id}>Section {section.name}</option>\n                            ))}\n                        </select>\n                    </div>\n                </div>\n\n                <div className=\"pt-6 text-right\">\n                    <button onClick={handleGenerateReport} className=\"bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded-lg text-lg\">\n                        Generate Report\n                    </button>\n                </div>\n            </div>\n\n            {/* The PrintableReport modal is only shown when `reportData` is not null. */}\n            {reportData && (\n                <PrintableReport\n                    title={`${reportTypes.find(r=>r.id === reportData.type)?.title} - ${selectedCourseName}`}\n                    onClose={() => setReportData(null)}\n                >\n                    {renderReportContent()}\n                </PrintableReport>\n            )}\n        </div>\n    );\n};\n\nexport default AttainmentReports;",
  "components/CourseOverviewTab.tsx": "/**\n * @file CourseOverviewTab.tsx\n * @description\n * This component is the \"Overview\" tab within the `CourseDetail` page. It's responsible for\n * displaying and allowing edits to the general settings of a course.\n *\n * What it does:\n * 1.  Displays settings like \"CO Target\", \"Internal Weightage\", and \"Attainment Level Thresholds\".\n * 2.  Allows a Program Co-ordinator to edit these values. The fields are disabled for other roles.\n * 3.  Uses a \"draft state\" pattern: when a user makes a change, it's not saved immediately.\n *     Instead, it's stored in a temporary \"draft\". This allows the user to either save\n *     all their changes at once or cancel them.\n * 4.  It shows the `SaveBar` component at the bottom of the screen as soon as any\n *     changes are made (i.e., when the \"draft\" is different from the original).\n */\n\nimport React, { useState, useEffect, useMemo } from 'react';\nimport { Course } from '../types';\nimport { useAppContext } from '../hooks/useAppContext';\nimport SaveBar from './SaveBar'; // Imports the bar for saving/canceling changes.\n\n// This defines the \"props\" or properties that this component accepts.\ninterface CourseOverviewTabProps {\n  course: Course; // It receives the full `Course` object it needs to display.\n}\n\nconst CourseOverviewTab: React.FC<CourseOverviewTabProps> = ({ course }) => {\n  // We ask our \"magic backpack\" (AppContext) for the tools we need.\n  const { setData, currentUser } = useAppContext();\n  // Check if the current user is a Program Co-ordinator, as they are the only ones who can edit.\n  const isCoordinator = currentUser?.role === 'Program Co-ordinator';\n\n  // --- State Management for Drafts ---\n  // We use two pieces of state to manage unsaved changes:\n  // 1. `draftCourse`: This holds the temporary changes the user is making. It's a copy.\n  const [draftCourse, setDraftCourse] = useState<Course>(course);\n  // 2. `initialCourse`: This is a snapshot of the original, saved state of the course.\n  const [initialCourse, setInitialCourse] = useState<Course>(course);\n\n  // `useEffect` runs code \"on the side\". This effect runs whenever the `course` prop changes\n  // (e.g., if the user navigates from one course to another). It resets both our draft\n  // and initial states to match the new course data.\n  useEffect(() => {\n    setDraftCourse(course);\n    setInitialCourse(course);\n  }, [course]);\n  \n  // `useMemo` is a performance helper. It calculates whether there are any unsaved changes\n  // by comparing the draft state to the initial state. It only recalculates when one of them changes.\n  const isDirty = useMemo(() => JSON.stringify(initialCourse) !== JSON.stringify(draftCourse), [initialCourse, draftCourse]);\n\n  // A helper function to update a single field in our `draftCourse` state.\n  const updateDraftCourseField = (field: keyof Course, value: any) => {\n    setDraftCourse(prev => ({ ...prev, [field]: value }));\n  };\n\n  // A helper function specifically for updating the nested attainment level values.\n  const updateDraftAttainmentLevel = (level: 'level1' | 'level2' | 'level3', value: number) => {\n     setDraftCourse(prev => ({ ...prev, attainmentLevels: { ...prev.attainmentLevels, [level]: value } }));\n  };\n\n  // This function is called when the user clicks \"Save Changes\" in the SaveBar.\n  const handleSave = () => {\n    // We update the main application data in our magic backpack.\n    setData(prev => ({\n      ...prev,\n      // We find the matching course in the main `courses` array and replace it with our `draftCourse`.\n      courses: prev.courses.map(c => c.id === course.id ? draftCourse : c)\n    }));\n    // After saving, the new \"original\" state is our draft. This makes `isDirty` false again.\n    setInitialCourse(draftCourse);\n    alert(\"Changes saved successfully!\");\n  };\n\n  // This function is called when the user clicks \"Cancel\" in the SaveBar.\n  const handleCancel = () => {\n    // We discard the draft by resetting it to the original, untouched `initialCourse` state.\n    setDraftCourse(initialCourse);\n  };\n\n\n  // The JSX below describes what the tab's content looks like.\n  return (\n    <div className=\"space-y-6 pb-20\">\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700\">CO Target (%)</label>\n          <input \n            type=\"number\" \n            value={draftCourse.target} // The input shows the value from our draft state.\n            onChange={e => updateDraftCourseField('target', Number(e.target.value))} // When it changes, we update the draft.\n            className=\"mt-1 w-full p-2 border border-gray-300 rounded-md bg-white text-gray-900 disabled:bg-gray-100 disabled:cursor-not-allowed\"\n            disabled={!isCoordinator} // The input is disabled if the user is not a coordinator.\n          />\n        </div>\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700\">Internal Weightage (%)</label>\n          <input \n            type=\"number\" \n            value={draftCourse.internalWeightage} \n            onChange={e => updateDraftCourseField('internalWeightage', Number(e.target.value))} \n            className=\"mt-1 w-full p-2 border border-gray-300 rounded-md bg-white text-gray-900 disabled:bg-gray-100 disabled:cursor-not-allowed\"\n            disabled={!isCoordinator}\n          />\n        </div>\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700\">External Weightage (%)</label>\n          <input \n            type=\"number\" \n            value={draftCourse.externalWeightage} \n            onChange={e => updateDraftCourseField('externalWeightage', Number(e.target.value))} \n            className=\"mt-1 w-full p-2 border border-gray-300 rounded-md bg-white text-gray-900 disabled:bg-gray-100 disabled:cursor-not-allowed\"\n            disabled={!isCoordinator}\n          />\n        </div>\n      </div>\n      \n      <div>\n        <h3 className=\"text-lg font-semibold text-gray-700 mb-2\">Attainment Level Thresholds</h3>\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n          <div>\n              <label className=\"block text-sm font-medium text-gray-700\">Level 3 (&ge; X % of students)</label>\n              <input \n                type=\"number\" \n                value={draftCourse.attainmentLevels.level3} \n                onChange={e => updateDraftAttainmentLevel('level3', Number(e.target.value))} \n                className=\"mt-1 w-full p-2 border border-gray-300 rounded-md bg-white text-gray-900 disabled:bg-gray-100 disabled:cursor-not-allowed\"\n                disabled={!isCoordinator}\n              />\n          </div>\n          <div>\n              <label className=\"block text-sm font-medium text-gray-700\">Level 2 (&ge; Y % of students)</label>\n              <input \n                type=\"number\" \n                value={draftCourse.attainmentLevels.level2} \n                onChange={e => updateDraftAttainmentLevel('level2', Number(e.target.value))} \n                className=\"mt-1 w-full p-2 border border-gray-300 rounded-md bg-white text-gray-900 disabled:bg-gray-100 disabled:cursor-not-allowed\"\n                disabled={!isCoordinator}\n              />\n          </div>\n           <div>\n              <label className=\"block text-sm font-medium text-gray-700\">Level 1 (&ge; Z % of students)</label>\n              <input \n                type=\"number\" \n                value={draftCourse.attainmentLevels.level1} \n                onChange={e => updateDraftAttainmentLevel('level1', Number(e.target.value))} \n                className=\"mt-1 w-full p-2 border border-gray-300 rounded-md bg-white text-gray-900 disabled:bg-gray-100 disabled:cursor-not-allowed\"\n                disabled={!isCoordinator}\n              />\n          </div>\n        </div>\n      </div>\n\n      {/* The SaveBar component is only shown if `isDirty` is true. */}\n      <SaveBar isDirty={isDirty} onSave={handleSave} onCancel={handleCancel} />\n    </div>\n  );\n};\n\nexport default CourseOverviewTab;",
  "pages/StudentsList.tsx": "/**\n * @file StudentsList.tsx\n * @description\n * This file defines the `StudentsList` component, which is the main page for viewing and\n * managing students. It's a highly dynamic page that adapts to the user's role and selections.\n *\n * What it does:\n * 1.  **Displays Students**: Shows a table of students.\n * 2.  **Role-Based Filtering**: The list of students is heavily filtered based on the user's\n *     role and their selections in the sidebar.\n *     - An **Admin** sees students based on their College/Program/Batch selection.\n *     - A **Department Head** sees all students in their college, further filtered by sidebar selections.\n *     - A **Program Co-ordinator** or **Teacher** sees all students in their selected program.\n * 3.  **Search**: Provides a search bar to filter students by name or ID.\n * 4.  **Student Management (for PC/Admin/Dept)**:\n *     - Allows adding a new student manually via a form.\n *     - Allows bulk-uploading students from an Excel file.\n *     - Allows changing a student's status ('Active' or 'Inactive') via a dropdown.\n * 5.  **View Details**: Provides a \"View Details\" button for each student that opens a popup\n *     (`StudentDetailsModal`) showing a detailed performance report for that student.\n */\n\nimport React, { useState, useMemo } from 'react';\nimport { useAppContext } from '../hooks/useAppContext';\nimport { Student, StudentStatus } from '../types';\nimport ExcelUploader from '../components/ExcelUploader';\nimport StudentDetailsModal from '../components/StudentDetailsModal';\nimport ConfirmationModal from '../components/ConfirmationModal';\n\nconst StudentsList: React.FC = () => {\n  // We ask our \"magic backpack\" (AppContext) for all the data and tools we need.\n  const { selectedProgram, selectedBatch, data, setData, currentUser, selectedCollegeId } = useAppContext();\n  \n  // --- State Management for Forms and UI ---\n  // Memory for the \"Add Student\" form fields.\n  const [newStudentId, setNewStudentId] = useState('');\n  const [newStudentName, setNewStudentName] = useState('');\n  // Memory for what the user has typed into the search bar.\n  const [searchTerm, setSearchTerm] = useState('');\n  // Memory to keep track of which student's details are being viewed in the popup.\n  const [selectedStudent, setSelectedStudent] = useState<Student | null>(null);\n  // Memory for the \"Are you sure?\" confirmation popup.\n  const [confirmation, setConfirmation] = useState<{\n        isOpen: boolean;\n        title: string;\n        message: string;\n        onConfirm: () => void;\n    } | null>(null);\n\n  // Simple booleans to check the user's role.\n  const isAdmin = currentUser?.role === 'Admin';\n  const isProgramCoordinator = currentUser?.role === 'Program Co-ordinator';\n  const isDepartmentHead = currentUser?.role === 'Department';\n  // A user can manage students if they are a PC, Admin, or Department Head.\n  const canManage = isProgramCoordinator || isAdmin || isDepartmentHead;\n\n  /**\n   * `useMemo` is a performance optimization, like a smart calculator. This one is very\n   * complex and figures out which students to show based on many different factors.\n   * It only recalculates when one of its inputs (the values in `[]`) changes.\n   */\n  const { filteredStudents, pageTitle, subTitle } = useMemo(() => {\n    let students: Student[];\n        \n    // --- Step 1: Get the initial list of students based on role and sidebar selections. ---\n    if (isAdmin) {\n        students = data.students; // An Admin starts with all students.\n        if (selectedProgram) { // If they selected a program...\n            students = students.filter(s => s.programId === selectedProgram.id);\n            if (selectedBatch) { // ...and also a batch...\n                // ...find the sections for that batch and only show students in those sections.\n                const batch = data.batches.find(b => b.programId === selectedProgram.id && b.name === selectedBatch);\n                if (batch) {\n                    const sectionsForBatch = data.sections.filter(s => s.batchId === batch.id);\n                    const sectionIdsForBatch = new Set(sectionsForBatch.map(s => s.id));\n                    students = students.filter(s => s.sectionId && sectionIdsForBatch.has(s.sectionId));\n                } else {\n                    students = []; // If the batch is invalid, show no one.\n                }\n            }\n        } else if (selectedCollegeId) { // If they only selected a college...\n            // ...find all programs in that college and show all students from those programs.\n            const programIdsInCollege = new Set(data.programs.filter(p => p.collegeId === selectedCollegeId).map(p => p.id));\n            students = students.filter(s => programIdsInCollege.has(s.programId));\n        }\n    } else if (isDepartmentHead && currentUser.collegeId) {\n        // A Department Head starts with all students in their assigned college.\n        const programIdsInCollege = new Set(data.programs.filter(p => p.collegeId === currentUser.collegeId).map(p => p.id));\n        students = data.students.filter(s => programIdsInCollege.has(s.programId));\n\n        // Then, we apply the sidebar filters if the user has selected them.\n        if (selectedProgram) {\n            students = students.filter(s => s.programId === selectedProgram.id);\n            if (selectedBatch) {\n                const batch = data.batches.find(b => b.programId === selectedProgram.id && b.name === selectedBatch);\n                if (batch) {\n                    const sectionsForBatch = data.sections.filter(s => s.batchId === batch.id);\n                    const sectionIdsForBatch = new Set(sectionsForBatch.map(s => s.id));\n                    students = students.filter(s => s.sectionId && sectionIdsForBatch.has(s.sectionId));\n                } else {\n                    students = [];\n                }\n            }\n        }\n    }\n    else { // For Teachers or PCs...\n        // ...they only see students from the program they have selected.\n        students = data.students.filter(s => s.programId === selectedProgram?.id);\n    }\n\n    // --- Step 2: Apply the search term filter. ---\n    if (searchTerm) {\n      const lowercasedFilter = searchTerm.toLowerCase();\n      students = students.filter(student =>\n        student.name.toLowerCase().includes(lowercasedFilter) ||\n        student.id.toLowerCase().includes(lowercasedFilter)\n      );\n    }\n    \n    // --- Step 3: Determine the page titles based on the context. ---\n    let title = 'Student Management';\n    if (isAdmin) {\n        title = selectedProgram\n            ? `Students in ${selectedProgram.name}`\n            : selectedCollegeId\n                ? `Students in ${data.colleges.find(c => c.id === selectedCollegeId)?.name}`\n                : 'All Students';\n    } else if (isDepartmentHead) {\n        title = selectedProgram\n            ? `Students in ${selectedProgram.name}`\n            : `Students in ${data.colleges.find(c => c.id === currentUser?.collegeId)?.name}`;\n    }\n\n    let subtitle = `Manage students for the ${selectedProgram?.name} program.`;\n    if (isAdmin || isDepartmentHead) {\n        subtitle = selectedBatch && selectedProgram\n            ? `Displaying batch ${selectedBatch}`\n            : 'Select a program and batch from the sidebar to filter students.';\n    }\n      \n    // --- Step 4: Return the final, sorted list and titles. ---\n    return {\n      filteredStudents: students.sort((a, b) => a.name.localeCompare(b.name)),\n      pageTitle: title,\n      subTitle: subtitle\n    }\n  }, [data, selectedProgram, selectedBatch, currentUser, selectedCollegeId, searchTerm, isAdmin, isDepartmentHead]);\n  \n  // A check to see if the \"Add Student\" form should be visible.\n  const canAddStudents = canManage && (isProgramCoordinator || (isAdmin && selectedProgram) || (isDepartmentHead && selectedProgram));\n\n  // This function is called when a user changes a student's status dropdown.\n  const handleStatusChange = (studentId: string, newStatus: StudentStatus) => {\n    // It opens the \"Are you sure?\" popup first.\n    setConfirmation({\n        isOpen: true,\n        title: \"Confirm Status Change\",\n        message: \"Are you sure you want to change this student's status?\",\n        onConfirm: () => {\n            // Only if the user clicks \"Confirm\" do we actually update the data.\n            setData(prev => ({\n                ...prev,\n                students: prev.students.map(s => s.id === studentId ? { ...s, status: newStatus } : s)\n            }));\n            setConfirmation(null); // Close the popup.\n        },\n    });\n  };\n\n  // This function runs when the \"Add Student\" form is submitted.\n  const handleAddStudent = (e: React.FormEvent) => {\n    e.preventDefault(); // Stop the page from reloading.\n    if (!newStudentId.trim() || !newStudentName.trim() || !selectedProgram) {\n      alert(\"Please provide both a Student ID and Name, and ensure a program is selected.\");\n      return;\n    }\n    \n    // Check for duplicate IDs.\n    if (data.students.some(s => s.id.toLowerCase() === newStudentId.trim().toLowerCase())) {\n        alert(\"A student with this ID already exists.\");\n        return;\n    }\n    // Create the new student object.\n    const newStudent: Student = {\n      id: newStudentId.trim(), name: newStudentName.trim(), programId: selectedProgram.id, status: 'Active'\n    };\n    // Add the new student to our main data in the magic backpack.\n    setData(prev => ({ ...prev, students: [...prev.students, newStudent] }));\n    // Clear the form fields.\n    setNewStudentId(''); setNewStudentName('');\n  };\n\n  // This is called by the ExcelUploader when a file is parsed.\n  const handleExcelUpload = (uploadedData: { id: string; name: string }[]) => {\n    if (!selectedProgram) { alert(\"Please select a program before bulk uploading students.\"); return; }\n    \n    const existingStudentIds = new Set(data.students.map(s => s.id.toLowerCase()));\n    // Convert the Excel rows into student objects, filtering out any duplicates.\n    const newStudents: Student[] = uploadedData\n      .filter(row => row.id && row.name && !existingStudentIds.has(String(row.id).toLowerCase()))\n      .map(row => ({\n        id: String(row.id), name: String(row.name), programId: selectedProgram.id, status: 'Active'\n      }));\n    // Add the new students to our main data.\n    setData(prev => ({ ...prev, students: [...prev.students, ...newStudents] }));\n    alert(`${newStudents.length} new students were added.`);\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <h1 className=\"text-3xl font-bold text-gray-800\">{pageTitle}</h1>\n      <p className=\"text-gray-500\">{subTitle}</p>\n      \n      {/* The \"Add Students\" section is only shown if the user has permission. */}\n      {canAddStudents && (\n        <div className=\"bg-white p-6 rounded-lg shadow-md\">\n          <div className=\"flex justify-between items-center mb-4\">\n              <h2 className=\"text-xl font-semibold text-gray-700\">Add Students</h2>\n               {/* FIX: Corrected the syntax for using the ExcelUploader component with generic types. The closing `>` was misplaced, causing props to be interpreted as children. */}\n              <ExcelUploader\n                onFileUpload={handleExcelUpload}\n                label=\"Upload Excel\"\n                format=\"columns: id, name\"\n              />\n          </div>\n          <form onSubmit={handleAddStudent} className=\"flex flex-wrap gap-4 items-end\">\n              <div className=\"flex-grow\">\n                  <label className=\"block text-sm font-medium text-gray-700\">Student ID</label>\n                  <input type=\"text\" value={newStudentId} onChange={e => setNewStudentId(e.target.value)} className=\"mt-1 w-full p-2 border border-gray-300 rounded-md bg-white text-gray-900\" required />\n              </div>\n               <div className=\"flex-grow-[2]\">\n                  <label className=\"block text-sm font-medium text-gray-700\">Student Name</label>\n                  <input type=\"text\" value={newStudentName} onChange={e => setNewStudentName(e.target.value)} className=\"mt-1 w-full p-2 border border-gray-300 rounded-md bg-white text-gray-900\" required />\n              </div>\n              <button type=\"submit\" className=\"bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg\">Add Student</button>\n          </form>\n        </div>\n      )}\n\n      {/* The main table of students. */}\n      <div className=\"bg-white rounded-lg shadow-md overflow-hidden\">\n        <div className=\"p-4 border-b\">\n          <input\n            type=\"text\"\n            placeholder=\"Search students by name or ID...\"\n            value={searchTerm}\n            onChange={e => setSearchTerm(e.target.value)}\n            className=\"w-full p-2 border border-gray-300 rounded-md bg-white text-gray-900 focus:ring-indigo-500 focus:border-indigo-500\"\n          />\n        </div>\n        <table className=\"min-w-full\">\n          <thead className=\"bg-gray-50\">\n            <tr>\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Student ID</th>\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Student Name</th>\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Status</th>\n              <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">Actions</th>\n            </tr>\n          </thead>\n          <tbody className=\"divide-y divide-gray-200\">\n            {filteredStudents.map((student) => (\n              <tr key={student.id} className=\"hover:bg-gray-50\">\n                <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">{student.id}</td>\n                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-600\">{student.name}</td>\n                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-600\">\n                    {canManage ? (\n                      <select\n                        value={student.status}\n                        onChange={(e) => handleStatusChange(student.id, e.target.value as StudentStatus)}\n                        className={`p-1 border rounded-md bg-white text-gray-900 focus:ring-indigo-500 focus:border-indigo-500 ${student.status === 'Active' ? 'border-green-300' : 'border-red-300'}`}\n                      >\n                        <option value=\"Active\">Active</option>\n                        <option value=\"Inactive\">Inactive</option>\n                      </select>\n                    ) : (\n                       <span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${student.status === 'Active' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>\\n                          {student.status}\n                      </span>\n                    )}\n                </td>\n                <td className=\"px-6 py-4 whitespace-nowrap text-right text-sm font-medium\">\n                  {/* When this button is clicked, it sets the `selectedStudent`, which opens the details modal. */}\n                  <button onClick={() => setSelectedStudent(student)} className=\"text-indigo-600 hover:text-indigo-800\">\n                    View Details\n                  </button>\n                </td>\n              </tr>\n            ))}\n            {filteredStudents.length === 0 && (\n                 <tr>\n                    <td colSpan={4} className=\"text-center py-8 text-gray-500\">\n                        No students found matching your criteria.\n                    </td>\n                </tr>\n            )}\n          </tbody>\n        </table>\n      </div>\n\n      {/* The `StudentDetailsModal` is only rendered if `selectedStudent` is not null. */}\n      {selectedStudent && (\n        <StudentDetailsModal student={selectedStudent} onClose={() => setSelectedStudent(null)} />\n      )}\n      \n      {/* The `ConfirmationModal` is only rendered if `confirmation` is not null. */}\n      {confirmation && (\n        <ConfirmationModal \n            isOpen={confirmation.isOpen}\n            title={confirmation.title}\n            message={confirmation.message}\n            onConfirm={confirmation.onConfirm}\n            onClose={() => setConfirmation(null)}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default StudentsList;",
  "components/CreateAssessmentModal.tsx": "/**\n * @file CreateAssessmentModal.tsx\n * @description\n * This component is a simple popup window (\"modal\") with a form for creating a new assessment\n * (like a test, a quiz, or a final exam) for a specific class section.\n *\n * What it does:\n * 1.  It's like a small order form. It receives the `sectionId` from its parent component\n *     (`ManageCourseAssessments`), which is like knowing which classroom the test is for.\n * 2.  It shows a form asking for the \"Assessment Name\" (e.g., \"Mid-Term Exam\") and \"Assessment Type\"\n *     (e.g., \"Internal\").\n * 3.  It uses its own little notepad (`useState`) to remember what the user is typing into the form.\n * 4.  When the user submits the form, it creates a new `Assessment` object (a new, empty test paper).\n * 5.  Finally, it adds this new test paper to our main application data using the `setData` function\n *     from our \"magic backpack\", so everyone knows a new test has been created.\n */\n\nimport React, { useState } from 'react';\nimport { useAppContext } from '../hooks/useAppContext';\nimport Modal from './Modal'; // We use our generic \"popup\" component as a base.\nimport { Assessment } from '../types'; // We get the blueprint for an 'Assessment' from our data dictionary.\n\n// This defines the \"props\" or properties this component needs from its parent.\ninterface CreateAssessmentModalProps {\n  sectionId: string; // The ID of the classroom this new assessment will belong to.\n  onClose: () => void; // A function to call to close the popup.\n}\n\nconst CreateAssessmentModal: React.FC<CreateAssessmentModalProps> = ({ sectionId, onClose }) => {\n  // We get the `setData` tool from our \"magic backpack\" to update the app's main data.\n  const { setData } = useAppContext();\n  \n  // We create pieces of memory on our \"notepad\" (`useState`) to store what the user types.\n  const [name, setName] = useState('');\n  const [type, setType] = useState<'Internal' | 'External'>('Internal');\n\n  // This function runs when the user clicks the \"Create\" button.\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault(); // Stop the page from reloading, which is what forms normally do.\n    if (!name.trim()) { alert(\"Please provide an assessment name.\"); return; }\n    \n    // We create a new \"assessment\" object based on the blueprint from `types.ts`.\n    const newAssessment: Assessment = {\n      id: `as_${Date.now()}`, // We create a unique ID based on the current time.\n      sectionId, // The classroom it belongs to.\n      name: name.trim(), // The name the user typed.\n      type, // The type the user selected.\n      questions: [] // A new assessment always starts with an empty list of questions.\n    };\n    \n    // We use our `setData` tool to add the new assessment to the main list in our \"magic backpack\".\n    setData(prev => ({ ...prev, assessments: [...prev.assessments, newAssessment] }));\n    \n    onClose(); // We call the function to close the popup.\n  };\n\n  return (\n    // We use our reusable `Modal` component as the frame for our popup.\n    <Modal title=\"Create New Assessment\" onClose={onClose}>\n      <form onSubmit={handleSubmit} className=\"p-6 space-y-4\">\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700\">Assessment Name</label>\n          <input\n            type=\"text\"\n            value={name} // The input's value is tied to our component's memory.\n            onChange={e => setName(e.target.value)} // When the user types, we update the memory.\n            className=\"mt-1 block w-full bg-white border border-gray-300 rounded-md shadow-sm py-2 px-3 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500\"\n            required\n          />\n        </div>\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700\">Assessment Type</label>\n          <select\n            value={type}\n            onChange={e => setType(e.target.value as 'Internal' | 'External')}\n            className=\"mt-1 block w-full bg-white border border-gray-300 rounded-md shadow-sm py-2 px-3 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500\"\n          >\n            <option value=\"Internal\">Internal</option>\n            <option value=\"External\">External</option>\n          </select>\n        </div>\n        <div className=\"flex justify-end pt-4 gap-3\">\n            <button type=\"button\" onClick={onClose} className=\"bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg\">Cancel</button>\n            <button type=\"submit\" className=\"bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg\">Create</button>\n        </div>\n      </form>\n    </Modal>\n  );\n};\n\nexport default CreateAssessmentModal;",
  "components/AddProgramOutcomeModal.tsx": "/**\n * @file AddProgramOutcomeModal.tsx\n * @description\n * This component is a simple popup window (\"modal\") with a form for adding a new\n * Program Outcome (PO) to the currently selected program. A PO is a big, important\n * skill that students should have when they graduate from the whole program.\n *\n * What it does:\n * 1.  It's like a suggestion box for adding a new big goal. It displays a form asking for the\n *     \"PO Number\" (like a label, e.g., \"PO1\") and its \"Description\" (e.g., \"Ability to work in a team\").\n * 2.  It uses its own little notepad (`useState`) to remember what the user is typing.\n * 3.  When the user submits the form, it creates a new `ProgramOutcome` object.\n * 4.  It then adds this new PO to the main application data using the `setData` function\n *     from our \"magic backpack\" (AppContext), so that everyone knows about the new goal.\n */\n\nimport React, { useState } from 'react';\nimport { useAppContext } from '../hooks/useAppContext';\nimport { ProgramOutcome } from '../types'; // We get the blueprint for a 'ProgramOutcome' from our data dictionary.\nimport Modal from './Modal'; // We use our generic \"popup\" component as a base.\n\n// This defines the \"props\" or properties this component needs from its parent.\ninterface AddProgramOutcomeModalProps {\n  onClose: () => void; // A function to call to close the popup.\n}\n\nconst AddProgramOutcomeModal: React.FC<AddProgramOutcomeModalProps> = ({ onClose }) => {\n  // We get the tools and data we need from our \"magic backpack\". We need `selectedProgram`\n  // to know which program this new PO belongs to.\n  const { setData, selectedProgram } = useAppContext();\n  \n  // We create pieces of memory on our \"notepad\" (`useState`) to store what the user types.\n  const [number, setNumber] = useState('');\n  const [description, setDescription] = useState('');\n\n  // This function runs when the user clicks the \"Add PO\" button.\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault(); // Stop the page from reloading.\n    if (!number.trim() || !description.trim() || !selectedProgram) {\n      alert(\"Please fill out all fields.\");\n      return;\n    }\n    \n    // We create a new \"program outcome\" object based on the blueprint from `types.ts`.\n    const newPO: ProgramOutcome = {\n      id: `po_manual_${Date.now()}`, // Create a unique ID based on the current time.\n      programId: selectedProgram.id, // Use the currently selected program's ID.\n      number: number.trim(), // The number the user typed.\n      description: description.trim() // The description the user typed.\n    };\n    \n    // We use our `setData` tool to add the new PO to the main list in our \"magic backpack\".\n    setData(prev => ({\n      ...prev,\n      programOutcomes: [...prev.programOutcomes, newPO]\n    }));\n    \n    onClose(); // We call the function to close the popup.\n  };\n\n  return (\n    // We use our reusable `Modal` component as the frame for our popup.\n    <Modal title=\"Add New Program Outcome\" onClose={onClose}>\n      <form onSubmit={handleSubmit} className=\"p-6 space-y-4\">\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700\">PO Number (e.g., PO1)</label>\n          <input\n            type=\"text\"\n            value={number} // The input's value is tied to our component's memory.\n            onChange={e => setNumber(e.target.value)} // When the user types, we update the memory.\n            className=\"mt-1 block w-full bg-white border border-gray-300 rounded-md shadow-sm py-2 px-3 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500\"\n            required\n          />\n        </div>\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700\">Description</label>\n          <textarea\n            value={description}\n            onChange={e => setDescription(e.target.value)}\n            rows={3}\n            className=\"mt-1 block w-full bg-white border border-gray-300 rounded-md shadow-sm py-2 px-3 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500\"\n            required\n          />\n        </div>\n        <div className=\"flex justify-end pt-4 gap-3\">\n          <button type=\"button\" onClick={onClose} className=\"bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg\">Cancel</button>\n          <button type=\"submit\" className=\"bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg\">Add PO</button>\n        </div>\n      </form>\n    </Modal>\n  );\n};\n\nexport default AddProgramOutcomeModal;",
  "components/ConfirmationModal.tsx": "/**\n * @file ConfirmationModal.tsx\n * @description\n * This file defines a very simple and reusable `ConfirmationModal` component.\n * It's the popup window that asks the user \"Are you sure?\" before they perform\n * a potentially destructive action, like deleting something.\n *\n * This component is like a puppet. It has no brain of its own. It is completely\n * controlled by the component that uses it (the \"parent\" component).\n *\n * How it's controlled by the parent:\n * - `isOpen`: A boolean that tells the modal whether to be visible or not.\n * - `title`: The text to show in the modal's title bar.\n * - `message`: The question or warning to show the user.\n * - `onConfirm`: A function to run ONLY if the user clicks the \"Confirm\" button.\n * - `onClose`: A function to run if the user clicks \"Cancel\" or the background.\n */\n\nimport React from 'react';\n\n// This defines the \"props\" or properties that this component accepts from its parent.\ninterface ConfirmationModalProps {\n  isOpen: boolean;\n  title: string;\n  message: string;\n  onConfirm: () => void;\n  onClose: () => void;\n}\n\nconst ConfirmationModal: React.FC<ConfirmationModalProps> = ({ isOpen, title, message, onConfirm, onClose }) => {\n  // If the parent tells us not to be open, we render nothing at all.\n  if (!isOpen) return null;\n\n  return (\n    // The semi-transparent background. Clicking it calls `onClose`.\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\" onClick={onClose}>\n      {/* The white content box. Clicking inside it does NOT close the modal. */}\n      <div className=\"bg-white rounded-lg shadow-xl p-6 w-full max-w-md mx-4\" onClick={(e) => e.stopPropagation()}>\n        <h2 className=\"text-xl font-bold text-gray-800\">{title}</h2>\n        <p className=\"mt-4 text-gray-600\">{message}</p>\n        <div className=\"mt-6 flex justify-end gap-4\">\n          <button type=\"button\" onClick={onClose} className=\"px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 font-semibold\">\n            Cancel\n          </button>\n          <button type=\"button\" onClick={onConfirm} className=\"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 font-semibold\">\n            Confirm\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default ConfirmationModal;",
  "components/StudentDetailsModal.tsx": "/**\n * @file StudentDetailsModal.tsx\n * @description\n * This component is a popup window (\"modal\") that shows a detailed performance\n * summary for a single student. It appears when a user clicks \"View Details\"\n * on the `StudentsList` page.\n *\n * What it does:\n * 1.  Receives a `student` object as a prop.\n * 2.  Finds all the courses the student is enrolled in.\n * 3.  For each course, it performs a complex calculation to determine the student's\n *     attainment percentage for every single Course Outcome (CO).\n * 4.  It also calculates the student's overall average attainment for each course.\n * 5.  It displays all this information in a clear, organized way, with one section\n *     per enrolled course.\n *\n * This component has a complex calculation logic, similar to the main report pages,\n * but it is scoped down to just one student.\n */\n\nimport React, { useMemo } from 'react';\nimport { Student } from '../types';\nimport { useAppContext } from '../hooks/useAppContext';\nimport Modal from './Modal';\n\n// This defines the \"props\" or properties that this component accepts.\ninterface StudentDetailsModalProps {\n  student: Student; // The student whose details we want to show.\n  onClose: () => void; // A function to close the modal.\n}\n\nconst StudentDetailsModal: React.FC<StudentDetailsModalProps> = ({ student, onClose }) => {\n  // We get all our application data from the \"magic backpack\".\n  const { data } = useAppContext();\n\n  /**\n   * This is the main calculation logic for the modal, wrapped in `useMemo` for performance.\n   * It will only re-run if the `student` or `data` changes.\n   */\n  const studentCourseData = useMemo(() => {\n    // --- Step 1: Find all courses this student is enrolled in. ---\n    const enrolledCourseIds = new Set(data.enrollments.filter(e => e.studentId === student.id).map(e => e.courseId));\n    const enrolledCourses = data.courses.filter(c => enrolledCourseIds.has(c.id));\n\n    // --- Step 2: Loop through each enrolled course and calculate the student's performance. ---\n    return enrolledCourses.map(course => {\n      const courseOutcomes = data.courseOutcomes.filter(co => co.courseId === course.id);\n\n      // If it's a future course, there's no data to calculate, so we can skip it.\n      if (course.status === 'Future') {\n        return { course, coAttainments: null, overallAttainment: null };\n      }\n\n      // --- Step 3: For each CO in the course, calculate the student's attainment percentage. ---\n      const coAttainments = courseOutcomes.map(co => {\n        let obtainedMarks = 0;\n        let possibleMarks = 0;\n\n        // Find all assessments for this course by looking at the sections.\n        const sectionIdsForCourse = new Set(data.enrollments.filter(e => e.courseId === course.id && e.sectionId).map(e => e.sectionId!));\n        const assessmentsForCourse = data.assessments.filter(a => sectionIdsForCourse.has(a.sectionId));\n\n        // Go through each assessment for the course.\n        assessmentsForCourse.forEach(assessment => {\n          // Find all questions in this assessment that are mapped to the current CO.\n          const questionsForCo = assessment.questions.filter(q => q.coIds.includes(co.id));\n\n          // For each of those questions...\n          questionsForCo.forEach(question => {\n            // ...find the student's mark entry for this assessment.\n            const studentMark = data.marks.find(m => m.assessmentId === assessment.id && m.studentId === student.id);\n            if (studentMark) {\n              // ...find their score for this specific question.\n              const score = studentMark.scores.find(s => s.q === question.q);\n              if (score !== undefined) {\n                // Add the student's score and the question's max marks to our totals.\n                obtainedMarks += score.marks;\n                possibleMarks += question.maxMarks;\n              }\n            }\n          });\n        });\n\n        // Calculate the final percentage for this CO.\n        const percentage = possibleMarks > 0 ? (obtainedMarks / possibleMarks) * 100 : 0;\n        \n        return { coNumber: co.number, percentage: percentage };\n      });\n\n      // --- Step 4: Calculate the student's overall average attainment for the whole course. ---\n      const overallAttainment = coAttainments.length > 0\n        ? coAttainments.reduce((sum, att) => sum + att.percentage, 0) / coAttainments.length\n        : 0;\n\n      return { course, coAttainments, overallAttainment };\n    });\n  }, [student, data]);\n\n  // The JSX that describes what the modal looks like.\n  return (\n    <Modal title={`Student Details: ${student.name}`} onClose={onClose}>\n      <div className=\"p-6 space-y-4 max-h-[80vh] overflow-y-auto\">\n        {/* Student's basic info */}\n        <div className=\"bg-gray-50 p-4 rounded-lg grid grid-cols-1 md:grid-cols-3 gap-x-4\">\n            <p><span className=\"font-semibold text-gray-600\">ID:</span> {student.id}</p>\n            <p><span className=\"font-semibold text-gray-600\">Name:</span> {student.name}</p>\n            <p><span className=\"font-semibold text-gray-600\">Status:</span> {student.status}</p>\n        </div>\n\n        <h3 className=\"text-lg font-semibold text-gray-700 pt-2 border-t\">Course Performance</h3>\n        {studentCourseData.map(({ course, coAttainments, overallAttainment }) => (\n            <div key={course.id} className=\"bg-gray-50/50 p-4 rounded-lg border\">\n                <div className=\"flex justify-between items-baseline\">\n                    <h4 className=\"font-semibold text-gray-800\">{course.name} ({course.code})</h4>\n                    {overallAttainment !== null ? (\n                        <p className=\"text-sm font-bold\">\n                            Overall:\n                            <span className={`ml-2 text-base ${overallAttainment >= course.target ? 'text-green-600' : 'text-red-600'}`}>\n                                {overallAttainment.toFixed(1)}%\n                            </span>\n                        </p>\n                    ) : <p className=\"text-sm text-gray-500\">Future Course</p>}\n                </div>\n\n                {coAttainments && (\n                    <div className=\"mt-2 grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-x-4 gap-y-1 text-sm\">\n                        {coAttainments.map(att => (\n                            <div key={att.coNumber}>\n                                <strong>{att.coNumber}:</strong>\n                                <span className={`ml-1 ${att.percentage >= course.target ? 'text-green-600' : 'text-red-600'}`}>\n                                    {att.percentage.toFixed(1)}%\n                                </span>\n                            </div>\n                        ))}\n                    </div>\n                )}\n            </div>\n        ))}\n         {studentCourseData.length === 0 && (\n            <p className=\"text-gray-500 text-center py-4\">This student is not enrolled in any courses.</p>\n        )}\n      </div>\n    </Modal>\n  );\n};\n\nexport default StudentDetailsModal;"
}